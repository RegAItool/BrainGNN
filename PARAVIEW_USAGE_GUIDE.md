# ParaView 3D Brain Visualization Guide

## 🎨 Advanced 3D Brain Pain Mapping with ParaView

This guide shows how to use ParaView for advanced 3D visualization of brain pain processing networks generated by the FC+GNN explainable analysis.

## 📦 Installation

### Option 1: Download ParaView
1. Visit: https://www.paraview.org/download/
2. Download ParaView for your operating system
3. Install following standard procedures

### Option 2: Using Package Manager (macOS)
```bash
brew install paraview
```

### Option 3: Using Package Manager (Ubuntu/Debian)
```bash
sudo apt-get install paraview
```

## 🗂️ Generated Files

The FC+GNN analysis generates the following ParaView-compatible files:

```
./paraview_data/
├── brain_regions_pain.vtk          # Brain regions with pain activation data
├── brain_connectivity_network.vtk  # Brain connectivity network
├── brain_analysis_metadata.json    # Analysis metadata
└── paraview_brain_visualization.py # Auto-generated ParaView script
```

## 🚀 Quick Start

### Method 1: Automated Script (Recommended)
1. Open ParaView
2. Go to `Tools` → `Python Shell`
3. Click `Run Script` and select `paraview_brain_visualization.py`
4. The visualization will be automatically configured

### Method 2: Manual Setup
1. **Load Brain Regions Data**:
   - File → Open → Select `brain_regions_pain.vtk`
   - Click Apply

2. **Create Sphere Representation**:
   - Add Glyph filter: Filters → Common → Glyph
   - Set Glyph Type: Sphere
   - Set Scalers: combined_importance
   - Set Scale Factor: 5.0
   - Click Apply

3. **Configure Colors**:
   - Color by: activation_diff
   - Set color map: Blue-White-Red
   - Show color bar

4. **Load Network Connections**:
   - File → Open → Select `brain_connectivity_network.vtk`
   - Set Representation: Wireframe
   - Set Line Width: 2.0

## 🎯 Key Visualization Features

### 1. Brain Region Spheres
- **Size**: Proportional to combined importance score
- **Color**: Blue (suppressed) to Red (enhanced activation)
- **Position**: Real MNI coordinates in 3D space

### 2. Connectivity Network
- **Lines**: Connections between important brain regions
- **Thickness**: Based on connectivity strength
- **Pattern**: Shows functional network architecture

### 3. Interactive Controls
- **Rotate**: Left-click and drag
- **Zoom**: Mouse wheel or right-click drag
- **Pan**: Middle-click drag
- **Reset View**: Click reset camera button

## 📊 Data Interpretation

### Color Coding
- 🔴 **Red spheres**: Enhanced activation during pain
- 🔵 **Blue spheres**: Suppressed during pain (active in no-pain state)
- ⚪ **White spheres**: Neutral activation

### Size Coding
- **Large spheres**: High combined importance score
- **Small spheres**: Lower importance score

### Network Connections
- **Thick lines**: Strong functional connectivity
- **Thin lines**: Weaker connectivity
- **No line**: Below connectivity threshold

## 🔍 Advanced Analysis Features

### 1. Top-K Region Filtering
```python
# In ParaView Python Console
threshold = pvs.Threshold(Input=brain_regions)
threshold.Scalars = ['POINTS', 'top_k_indicator']
threshold.ThresholdRange = [1.0, 1.0]  # Show only top-K regions
```

### 2. Statistical Significance Filtering
```python
# Filter by p-value significance
sig_threshold = pvs.Threshold(Input=brain_regions)
sig_threshold.Scalars = ['POINTS', 'p_value']
sig_threshold.ThresholdRange = [0.0, 0.05]  # p < 0.05
```

### 3. Network-Specific Views
Use the metadata JSON to filter by brain networks:
- Cognitive Control Network
- Sensorimotor Network
- Visual Network
- Cerebellar Network
- Limbic Network

## 🎨 Visualization Tips

### 1. Optimal Camera Settings
- **Position**: (100, 100, 100)
- **Focal Point**: (0, 0, 0)
- **View Up**: (0, 0, 1)

### 2. Lighting Enhancements
- Add multiple light sources for better 3D depth
- Use ambient lighting for overall visibility
- Adjust specular highlights for sphere surfaces

### 3. Color Map Customization
```python
# Custom pain activation color map
lut = pvs.GetColorTransferFunction('activation_diff')
lut.RGBPoints = [
    -1.0, 0.0, 0.0, 1.0,    # Deep blue for strong suppression
    -0.5, 0.3, 0.3, 1.0,    # Light blue for mild suppression
     0.0, 1.0, 1.0, 1.0,    # White for neutral
     0.5, 1.0, 0.3, 0.3,    # Pink for mild enhancement
     1.0, 1.0, 0.0, 0.0     # Deep red for strong enhancement
]
```

## 📹 Creating Animations

### 1. Rotation Animation
```python
# Create rotation animation
camera = pvs.GetActiveCamera()
pvs.GetAnimationScene().PlayMode = 'Real Time'

# Set up rotation keyframes
for angle in range(0, 360, 10):
    camera.Azimuth(10)
    pvs.WriteAnimation('brain_rotation.avi')
```

### 2. Threshold Animation
```python
# Animate importance threshold
for threshold_val in np.linspace(0, 1, 50):
    threshold.ThresholdRange = [threshold_val, 1.0]
    pvs.Render()
    pvs.WriteImage(f'frame_{threshold_val:.2f}.png')
```

## 📊 Data Export Options

### 1. High-Quality Images
```python
# Set render view size
renderView = pvs.GetActiveViewOrCreate('RenderView')
renderView.ViewSize = [1920, 1080]

# Save high-resolution image
pvs.SaveScreenshot('brain_pain_analysis_4K.png', renderView, 
                   ImageResolution=[3840, 2160])
```

### 2. 3D Model Export
```python
# Export as X3D for web viewing
pvs.SaveData('brain_pain_model.x3d', brain_regions)

# Export as PLY for 3D printing
pvs.SaveData('brain_pain_model.ply', brain_regions)
```

## 🔬 Scientific Applications

### 1. Research Presentations
- High-quality 3D visualizations for conferences
- Interactive exploration during talks
- Multiple viewpoints for comprehensive analysis

### 2. Clinical Decision Support
- Visual representation of patient-specific brain patterns
- Comparison of pre/post treatment networks
- Treatment target identification

### 3. Educational Purposes
- Teaching brain pain processing mechanisms
- Demonstrating network connectivity concepts
- Interactive anatomy exploration

## 🛠️ Troubleshooting

### Common Issues

1. **File Loading Problems**:
   - Ensure VTK files are not corrupted
   - Check file paths are correct
   - Verify ParaView version compatibility

2. **Performance Issues**:
   - Reduce sphere resolution for large datasets
   - Use level-of-detail (LOD) for complex networks
   - Optimize color map resolution

3. **Visualization Problems**:
   - Reset camera if view is lost
   - Check data ranges for color mapping
   - Verify filter parameters

### Performance Optimization
```python
# Reduce sphere resolution for better performance
glyph.GlyphType.ThetaResolution = 8
glyph.GlyphType.PhiResolution = 8

# Use LOD for large networks
renderView.LODThreshold = 1000
```

## 📚 Additional Resources

- [ParaView User Guide](https://docs.paraview.org/en/latest/)
- [VTK File Format Specification](https://vtk.org/wp-content/uploads/2015/04/file-formats.pdf)
- [Brain Connectivity Analysis Tutorials](https://www.nitrc.org/projects/conn)

## 🎉 Advanced Features

### Custom Filters
Create custom ParaView filters for:
- Brain region clustering
- Network community detection
- Temporal connectivity analysis
- Multi-subject comparisons

### Plugin Development
Develop custom plugins for:
- Specialized brain atlases
- Advanced connectivity metrics
- Statistical analysis integration
- Real-time data streaming

---

*Generated by BrainGNN FC+GNN Explainable Analysis System*
*For technical support, refer to the analysis documentation*