<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Brain Pain Visualization</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .viewer-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .brain-display {
            width: 100%;
            height: 500px;
            background: radial-gradient(circle, #1a1a2e, #16213e);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .brain-region {
            position: absolute;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            border: 2px solid rgba(255, 255, 255, 0.5);
        }
        
        .brain-region:hover {
            transform: scale(1.2);
            z-index: 10;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
        }
        
        .enhanced {
            background: radial-gradient(circle, #ff6b6b, #ee5a24);
            animation: pulse-red 2s infinite;
        }
        
        .suppressed {
            background: radial-gradient(circle, #74b9ff, #0984e3);
            animation: pulse-blue 2s infinite;
        }
        
        .top-k {
            border: 3px solid #ffd700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
        }
        
        @keyframes pulse-red {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }
        
        @keyframes pulse-blue {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .control-panel {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
        }
        
        .control-panel h3 {
            margin-top: 0;
            color: #ffd700;
        }
        
        .slider-container {
            margin: 10px 0;
        }
        
        .slider {
            width: 100%;
            margin: 5px 0;
        }
        
        .info-panel {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .region-details {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            min-height: 100px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #ffd700;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid white;
        }
        
        .brain-outline {
            position: absolute;
            top: 10%;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 250px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            opacity: 0.5;
        }
        
        .cerebellum-outline {
            position: absolute;
            bottom: 15%;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 80px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            opacity: 0.5;
        }
        
        .rotate-animation {
            animation: rotate 10s linear infinite;
        }
        
        @keyframes rotate {
            from { transform: translateX(-50%) rotate(0deg); }
            to { transform: translateX(-50%) rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß† 3D Brain Pain Processing Visualization</h1>
        <p style="text-align: center; font-size: 1.1em; margin-bottom: 30px;">
            FC+GNN Analysis: Interactive Brain Region Explorer
        </p>
        
        <div class="viewer-section">
            <div class="controls">
                <div class="control-panel">
                    <h3>üéõÔ∏è View Controls</h3>
                    <div class="slider-container">
                        <label>Animation Speed:</label>
                        <input type="range" class="slider" id="animSpeed" min="0" max="3" value="1" step="0.1">
                    </div>
                    <div class="slider-container">
                        <label>Region Size:</label>
                        <input type="range" class="slider" id="regionSize" min="0.5" max="2" value="1" step="0.1">
                    </div>
                    <div>
                        <label><input type="checkbox" id="showTopK" checked> Show Top-K Only</label><br>
                        <label><input type="checkbox" id="enableRotation" checked> Auto Rotation</label>
                    </div>
                </div>
                
                <div class="control-panel">
                    <h3>üé® Color Mode</h3>
                    <label><input type="radio" name="colorMode" value="activation" checked> Pain Activation</label><br>
                    <label><input type="radio" name="colorMode" value="importance"> Importance</label><br>
                    <label><input type="radio" name="colorMode" value="network"> Networks</label>
                </div>
                
                <div class="control-panel">
                    <h3>üìä Quick Stats</h3>
                    <div class="stat-value" style="font-size: 1.2em;">15</div>
                    <div>Top-K Regions</div>
                    <div class="stat-value" style="font-size: 1.2em;">98.7%</div>
                    <div>Model Accuracy</div>
                </div>
            </div>
        </div>
        
        <div class="brain-display" id="brainDisplay">
            <div class="brain-outline" id="brainOutline"></div>
            <div class="cerebellum-outline"></div>
            <!-- Brain regions will be added here by JavaScript -->
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #ff6b6b;"></div>
                <span>Pain Enhanced</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #74b9ff;"></div>
                <span>Pain Suppressed</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: transparent; border-color: #ffd700;"></div>
                <span>Top-K Important</span>
            </div>
        </div>
        
        <div class="info-panel">
            <h3>üîç Region Information</h3>
            <div class="region-details" id="regionDetails">
                <p>Click on a brain region to see detailed information</p>
                <p><strong>Tip:</strong> Hover over regions to see them highlighted</p>
            </div>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value">36</div>
                <div>Total Regions</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">9</div>
                <div>Networks</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">8</div>
                <div>Enhanced</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">28</div>
                <div>Suppressed</div>
            </div>
        </div>
    </div>

    <script>
        // Brain regions data (from the analysis)
        const brainRegions = [
            {name: "Postcentral_L", pos: [20, 35], activation: 0.000437, importance: 2.525, network: "sensorimotor", isTopK: true, type: "Enhanced"},
            {name: "Postcentral_R", pos: [80, 35], activation: 0.000155, importance: 0.915, network: "sensorimotor", isTopK: true, type: "Enhanced"},
            {name: "Cerebelum_Crus1_L", pos: [35, 80], activation: 0.000142, importance: 0.763, network: "cerebellar", isTopK: true, type: "Enhanced"},
            {name: "Frontal_Sup_R", pos: [75, 15], activation: 0.000138, importance: 0.762, network: "cognitive_control", isTopK: true, type: "Enhanced"},
            {name: "Frontal_Sup_L", pos: [25, 15], activation: 0.000155, importance: 0.691, network: "cognitive_control", isTopK: true, type: "Enhanced"},
            {name: "Frontal_Mid_L", pos: [15, 25], activation: 0.000158, importance: 0.602, network: "cognitive_control", isTopK: true, type: "Enhanced"},
            {name: "Frontal_Mid_R", pos: [85, 25], activation: 0.000141, importance: 0.317, network: "cognitive_control", isTopK: true, type: "Enhanced"},
            {name: "Occipital_Mid_R", pos: [70, 75], activation: 0.000142, importance: 0.289, network: "visual", isTopK: true, type: "Enhanced"},
            {name: "Hippocampus_L", pos: [40, 50], activation: 0.0, importance: 0.247, network: "limbic", isTopK: true, type: "Suppressed"},
            {name: "Thalamus_L", pos: [45, 45], activation: 0.0, importance: 0.232, network: "subcortical", isTopK: true, type: "Suppressed"},
            {name: "ParaHippocampal_L", pos: [35, 55], activation: 0.0, importance: 0.135, network: "limbic", isTopK: true, type: "Suppressed"},
            {name: "Putamen_L", pos: [42, 40], activation: 0.0, importance: 0.134, network: "subcortical", isTopK: true, type: "Suppressed"},
            {name: "Amygdala_L", pos: [38, 48], activation: 0.0, importance: 0.097, network: "limbic", isTopK: true, type: "Suppressed"},
            {name: "Parietal_Sup_R", pos: [78, 40], activation: 0.0, importance: 0.082, network: "attention", isTopK: true, type: "Suppressed"},
            {name: "Thalamus_R", pos: [55, 45], activation: 0.0, importance: 0.082, network: "subcortical", isTopK: true, type: "Suppressed"}
        ];

        let currentSizeScale = 1.0;
        let showTopKOnly = true;
        let rotationEnabled = true;
        let colorMode = 'activation';

        function initializeBrainVisualization() {
            const brainDisplay = document.getElementById('brainDisplay');
            
            brainRegions.forEach((region, index) => {
                const regionElement = document.createElement('div');
                regionElement.className = 'brain-region';
                regionElement.id = `region-${index}`;
                
                // Position
                regionElement.style.left = region.pos[0] + '%';
                regionElement.style.top = region.pos[1] + '%';
                
                // Size based on importance
                const baseSize = 15 + (region.importance / 3.0) * 25;
                regionElement.style.width = baseSize + 'px';
                regionElement.style.height = baseSize + 'px';
                regionElement.style.marginLeft = (-baseSize/2) + 'px';
                regionElement.style.marginTop = (-baseSize/2) + 'px';
                
                // Color and class
                updateRegionAppearance(regionElement, region);
                
                // Label
                regionElement.textContent = region.name.split('_')[0];
                
                // Event listeners
                regionElement.addEventListener('click', () => showRegionDetails(region));
                regionElement.addEventListener('mouseenter', () => highlightRegion(regionElement));
                regionElement.addEventListener('mouseleave', () => unhighlightRegion(regionElement));
                
                brainDisplay.appendChild(regionElement);
            });
            
            setupControls();
        }

        function updateRegionAppearance(element, region) {
            // Clear existing classes
            element.className = 'brain-region';
            
            // Add type class
            if (colorMode === 'activation') {
                element.classList.add(region.type.toLowerCase());
            } else if (colorMode === 'importance') {
                const intensity = Math.min(region.importance / 3.0, 1.0);
                const hue = 60 * (1 - intensity); // Yellow to red
                element.style.background = `radial-gradient(circle, hsl(${hue}, 80%, 60%), hsl(${hue}, 80%, 40%))`;
            } else if (colorMode === 'network') {
                const networkColors = {
                    'sensorimotor': 'radial-gradient(circle, #00ff00, #008800)',
                    'cerebellar': 'radial-gradient(circle, #ff0000, #880000)',
                    'cognitive_control': 'radial-gradient(circle, #0000ff, #000088)',
                    'visual': 'radial-gradient(circle, #ffa500, #cc8400)',
                    'limbic': 'radial-gradient(circle, #ff00ff, #cc00cc)',
                    'subcortical': 'radial-gradient(circle, #00ffff, #00cccc)',
                    'attention': 'radial-gradient(circle, #ffff00, #cccc00)'
                };
                element.style.background = networkColors[region.network] || 'radial-gradient(circle, #cccccc, #888888)';
            }
            
            // Add top-K class
            if (region.isTopK) {
                element.classList.add('top-k');
            }
            
            // Visibility
            element.style.display = (!showTopKOnly || region.isTopK) ? 'flex' : 'none';
        }

        function setupControls() {
            // Animation speed
            document.getElementById('animSpeed').addEventListener('input', (e) => {
                const speed = parseFloat(e.target.value);
                const outline = document.getElementById('brainOutline');
                if (speed > 0 && rotationEnabled) {
                    outline.style.animationDuration = (10 / speed) + 's';
                    outline.classList.add('rotate-animation');
                } else {
                    outline.classList.remove('rotate-animation');
                }
            });

            // Region size
            document.getElementById('regionSize').addEventListener('input', (e) => {
                currentSizeScale = parseFloat(e.target.value);
                updateAllRegions();
            });

            // Show top-K only
            document.getElementById('showTopK').addEventListener('change', (e) => {
                showTopKOnly = e.target.checked;
                updateAllRegions();
            });

            // Enable rotation
            document.getElementById('enableRotation').addEventListener('change', (e) => {
                rotationEnabled = e.target.checked;
                const outline = document.getElementById('brainOutline');
                if (rotationEnabled) {
                    outline.classList.add('rotate-animation');
                } else {
                    outline.classList.remove('rotate-animation');
                }
            });

            // Color mode
            document.querySelectorAll('input[name="colorMode"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    colorMode = e.target.value;
                    updateAllRegions();
                });
            });
        }

        function updateAllRegions() {
            brainRegions.forEach((region, index) => {
                const element = document.getElementById(`region-${index}`);
                if (element) {
                    // Update size
                    const baseSize = (15 + (region.importance / 3.0) * 25) * currentSizeScale;
                    element.style.width = baseSize + 'px';
                    element.style.height = baseSize + 'px';
                    element.style.marginLeft = (-baseSize/2) + 'px';
                    element.style.marginTop = (-baseSize/2) + 'px';
                    
                    // Update appearance
                    updateRegionAppearance(element, region);
                }
            });
        }

        function showRegionDetails(region) {
            const detailsPanel = document.getElementById('regionDetails');
            detailsPanel.innerHTML = `
                <h4>${region.name}</h4>
                <p><strong>Network:</strong> ${region.network}</p>
                <p><strong>Type:</strong> ${region.type}</p>
                <p><strong>Activation:</strong> ${region.activation > 0 ? '+' : ''}${region.activation.toFixed(6)}</p>
                <p><strong>Importance Score:</strong> ${region.importance.toFixed(3)}</p>
                <p><strong>Top-K Status:</strong> ${region.isTopK ? '‚úÖ Selected' : '‚ùå Not selected'}</p>
                <p><strong>Description:</strong> ${getRegionDescription(region)}</p>
            `;
        }

        function getRegionDescription(region) {
            const descriptions = {
                'Postcentral_L': 'Primary somatosensory cortex - processes touch and pain sensations',
                'Postcentral_R': 'Right somatosensory cortex - bilateral pain processing',
                'Cerebelum_Crus1_L': 'Cerebellar region - sensorimotor integration and pain modulation',
                'Frontal_Sup_R': 'Superior frontal gyrus - cognitive control and attention',
                'Frontal_Sup_L': 'Left superior frontal - top-down pain regulation',
                'Frontal_Mid_L': 'Middle frontal gyrus - executive control functions'
            };
            return descriptions[region.name] || 'Key brain region involved in pain processing';
        }

        function highlightRegion(element) {
            element.style.zIndex = '100';
            element.style.transform = 'scale(1.3)';
            element.style.boxShadow = '0 0 25px rgba(255, 255, 255, 1)';
        }

        function unhighlightRegion(element) {
            element.style.zIndex = '';
            element.style.transform = '';
            element.style.boxShadow = '';
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeBrainVisualization);
    </script>
</body>
</html>